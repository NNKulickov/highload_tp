# Booking.com

## 1. Аудитория
Booking.com мировой лидер среди OTA(до недавнего времени единственный), которым пользуются люди разных возрастов и полов по всему миру. 
На [текущий](https://www.booking.com/content/about.ru.html?aid=356980&label=gog235jc-1DCBQoggJCBWFib3V0SDNYA2jCAYgBAZgBIbgBB8gBD9gBA-gBAYgCAagCA7gCrfqYmQbAAgHSAiQyYzVkNDIxYy1hZjE0LTRjNzItOTg4NC0xMDZjMWE5OGMwNGPYAgTgAgE&sid=7a8c633e3408de454615515c7a37247d&keep_landing=1&)
момент имеет 43 языка и варианты размещения в 228 [странах](https://lesboutiquehotels.com/booking-com-reviews#reliable) мира.
Доступен на всех платформах.

Согласно [статистике](https://www.semrush.com/website/booking.com/overview/) Booking обслуживает ежемесячно ~400 млн. пользователей в среднем за год.
Доля распределения пользователей по странам следующая.

| United States | Germany | Italy | Spain | France | Other  |
|---------------|---------|-------|-------|--------|--------|
|  12.24%       | 8.36%   | 7.04% | 6.21% | 4.06%  | 62.09% |


## 2. MVP
Минимальный функционал booking.com:
1. Регистрация / авторизация;
2. Поиск размещений во внутреннем хранилище и через партнеров;
3. Бронирование варианта размещения;

## 3. Расчёт нагрузки

### Продуктовые метрики
Booking.com как любой OTA использует двойную систему поиска доступности как в своем собственном хранлище, так и у поставщиков.
Для конечного пользователя важны скорость отдачи информации и ее актуальность.

#### 1. Месячная аудиория

Месячная аудитория сервиса в среднем составляет примерно 400 миллионов людей.

#### 2. Дневная аудиория

Дневная аудитория сервиса в среднем составляет примерно 13.3 млн пользователей.

#### 3. Средний размер хранилища пользователя

Информация пользователя всегда стандартная и выглядит след образом.

#### user:

| Название   | Тип         | Размер  |
|------------|-------------|---------|
| id         | int         | 8 байт  |
| firstName  | varchar(64) | 64 байт |
| lastName   | varchar(64) | 64 байт |
| email      | varchar(64) | 64 байт |
| password   | varchar(64) | 64 байт |
| modifiedAt | Date        | 3 байт  |
| createdAt  | Date        | 3 байт  |

#### card:

| Название   | Тип         | Размер  |
|------------|-------------|---------|
| id         | int         | 8 байт  |
| number     | varchar(64) | 64 байт |
| expiration | Date        | 64 байт |
| holder     | varchar(64) | 64 байт |
| ccv        | int         | 8 байт  |
| createdAt  | Date        | 3 байт  |


#### user_card:

| Название | Тип | Размер |
|----------|-----|--------|
| user_id  | int | 8 байт |
| card_id  | int | 8 байт |


#### history:

| Название  | Тип  | Размер |
|-----------|------|--------|
| user_id   | int  | 8 байт |
| inv_id    | int  | 8 байт |
| createdAt | Date | 3 байт |

Из таблиц можно посчитать, что суммарный вес таблицы пользователя составил 518.
Данные пользователя особо не растут, за исключением истории поиска. Для удобства положим, что в среднем один пользователь
путешествует не более 10ти раз в месяц. Таким образом история поездок будет расти не более чем $(400*10*(8+8+3)/1024)$ = 82 кБ.

///////

* Среднее количество действий пользователя по типам в день

Каждый день пользователь производит логин и логаут - это два запроса.


Чтобы подключиться к комнате происходит запрос на добавление, запрос об информации комнаты и запрос на отключение. В день пользователь просматривает примерно 6 комнат, в которых, положим, просматривает профиль двух спикеров. Получается, что происходит 18 запросов на подключения к комнатам и ещё 12 запросов на получения информации о спикерах.

В среднем в день от пользователя происходит 32 запроса.

Расчитаем пиковую нагрузку:


`
13.4 * 10^6 / 100 * 20 * 32 / 24 / 60 / 60 = 993 RPS
`

### Технические метрики
Всего в clubhouse зарегистрированно [13,4 миллиона](https://www.bbc.com/news/technology-57058516#:~:text=Clubhouse%20had%20about%2013.4%20million,store%20analysts%20Sensor%20Tower%20said.) пользователей.

Clubhouse доступен только на телефоны от apple, что означает, что у каждого пользователя может быть одновременно только одна сессия.

* Размер хранения в разбивке по типам данных

Посчитаем размер хранилища информации о пользователях:


`
13,4 * 10^6 (пользователей) * 264 (байт) = 3537600000 Байт = 3,5376 Гигабайт
`

Далее посчитаем размер хранилища пользовательских сессий, учитывая, что при пиковой нагрузке сервисом пользуется 10 миллионов человек:


`
10 * 10^6 (пользователей) * 24 (байт) = 240000000 Байт = 0,24 Гигабайта
`

Допустим, что каждый активный пользователь создал хотя бы одну комнату. Тогда имеем:

`
10 *10^6 (пользователей) * 137 (байт) = 1370000000 Байт = 1,37 Гигабайт
`

Считаем, что в среднем каждый пользовател подписан на 7 комнат, получим:

`
13,4 * 10^6 (пользователей) * 17 (байт) * 7 = 1594600000 Байт = 1,5946 Гигабайт
`

* Сетевой трафик

Для передачи аудио высокого качества звука необходим интернет со скоростью [2.4 МБ в минуту](https://bool.dev/news/detail/skolko-vam-nuzhno-trafika-na-audio-i-video-kontent-dlya-vashego-smartfona), то есть 0.32 МБит в секунду.

Посчитаем суммарный суточный траффик, предполагая что максимальная нагрузка на сервис в сутки - 10000000 миллионов пользователей:

`
10 * 10^6 * 2.4 * 37 = 888000 Гигабайт в сутки
`

Попробуем предположить пиковое нагрузку в течении суток, для этого воспользуемся законом Парето. Предположим, что 20 процетов от суточного количества активных пользователей clubhouse одновременно будут использовать приложение. Чтобы проверить данно предположение проанализируем статистику от другого высоконагруженного сервиса Discord, в котором количество активных пользователей в сутки составляет [14 миллионов пользователей](https://github.com/NikitaLobaev/Technopark_Highload), а при пиковой нагрузке количество пользователей составляет примерно [2,78 миллиона](https://github.com/NikitaLobaev/Technopark_Highload). Считаем: `14 * 10^6 / 100 * 20 = 2 800 000` пользователей, что примерно составляет 20 процентов от ежедневного количества активных пользователей.

Получаем для clubhouse пиковую нагрузку в 2.68 миллиона пользователей.

Считаем:

`
2.68 * 10^6 * 2.4 (Мб в минуту) / 60 (Секунд) = 858 Гигабит / С
`

<!-- Из приведенных выше данных можно сделать вывод, что суммарный суточный траффик составляет примерно 886704 Гбайт в сутки. -->

* RPS в разбивке по типам запросов

Запросы будут приходить на основной сервер и на сервера, отвечающие за трансляции.

Приведенные выше данные посчитаем RPS в разбивке по типам запросов:

Для подключения к конференции пользователь должен совершить три запроса (см. выше), ежедневно пользователь заходит в 6 комнат значит:

`
13.4 * 10^6 / 100 * 20 * 3 * 6 / 24 / 60 / 60 = 589 RPS
`
